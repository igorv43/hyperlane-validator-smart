#!/bin/bash

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘  IDENTIFICAR CONTA account_index: 5                                      â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

echo "Analisando os logs da simulaÃ§Ã£o para identificar qual conta Ã© account_index: 5"
echo ""

# Extrair informaÃ§Ãµes dos logs
RECIPIENT="BirXd4QDxfq2vx9LGqgXXSgZrjT81rhoFGUbQRWDEf1j"
RELAYER_ADDRESS="C4jCuG3DjRdAnDJkJLXn711ShWDiat5nSTAZKYzPPCnY"

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ANÃLISE DOS LOGS"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

echo "Dos logs da simulaÃ§Ã£o, vejo que:"
echo ""
echo "1. A transaÃ§Ã£o tenta criar uma Associated Token Account (ATA)"
echo "2. Recipient: $RECIPIENT"
echo "3. O erro ocorre em account_index: 5"
echo ""
echo "Em Solana, as contas em uma transaÃ§Ã£o sÃ£o indexadas assim:"
echo "  account_index: 0 = Signer principal (relayer)"
echo "  account_index: 1 = Program/Account sendo chamado"
echo "  account_index: 2-4 = Outras contas necessÃ¡rias"
echo "  account_index: 5 = CONTA QUE ESTÃ FALTANDO SOL"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "POSSÃVEIS CAUSAS"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

echo "account_index: 5 provavelmente Ã©:"
echo "  1. A Associated Token Account (ATA) sendo criada"
echo "  2. Ou uma conta derivada necessÃ¡ria para a transaÃ§Ã£o"
echo ""
echo "O problema Ã© que essa conta precisa de SOL para rent exemption,"
echo "mas o SOL estÃ¡ apenas no signer principal (account_index: 0)."
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "SOLUÃ‡ÃƒO"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

echo "O relayer deve transferir SOL do signer principal para a conta"
echo "derivada antes de criar a transaÃ§Ã£o, OU a transaÃ§Ã£o deve incluir"
echo "uma instruÃ§Ã£o para transferir SOL."
echo ""
echo "âš ï¸  Isso pode ser um bug no relayer ou uma configuraÃ§Ã£o incorreta."
echo ""
echo "ğŸ”§ SOLUÃ‡Ã•ES A TENTAR:"
echo ""
echo "1. Adicionar MUITO mais SOL (5-10 SOL) para garantir que hÃ¡ suficiente"
echo "2. Verificar se hÃ¡ uma configuraÃ§Ã£o do relayer para prÃ©-funding de contas"
echo "3. Verificar se o relayer estÃ¡ usando a versÃ£o correta"
echo "4. Verificar se hÃ¡ uma forma de configurar o relayer para prÃ©-criar ATAs"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "AÃ‡ÃƒO IMEDIATA"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

echo "1. Adicionar mais SOL (5-10 SOL recomendado):"
echo "   Faucet: https://faucet.solana.com/"
echo "   EndereÃ§o: $RELAYER_ADDRESS"
echo ""
echo "2. Reiniciar relayer completamente:"
echo "   cd teste-relayer"
echo "   docker compose -f docker-compose-relayer-only.yml stop relayer"
echo "   docker compose -f docker-compose-relayer-only.yml up -d relayer"
echo ""
echo "3. Monitorar logs por 10 minutos:"
echo "   docker logs -f hpl-relayer-testnet-local | grep -iE 'solana|insufficient|rent|error'"
echo ""

